name: Analyse de sécurité Nikto

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  workflow_dispatch:   # permet de déclencher manuellement si besoin

jobs:
  nikto_scan:
    runs-on: ubuntu-latest

    steps:
      - name: 🧩 Récupération du code source
        uses: actions/checkout@v4

      - name: 🐍 Installation de Python et des dépendances
        run: |
          sudo apt-get update -y
          sudo apt-get install -y python3 python3-pip
          pip install -r requirements.txt || true

      - name: 🚀 Lancer le serveur Flask en arrière-plan
        run: |
          nohup python3 app.py &
          sleep 10   # Attendre que le serveur démarre

      - name: 🧰 Installer Nikto
        run: |
          sudo apt-get install -y nikto

      - name: 🧪 Exécuter l’analyse Nikto
        run: |
          nikto -h http://127.0.0.1:5000 -o rapport_nikto.txt -Format txt
          cat rapport_nikto.txt

      - name: 💾 Sauvegarder le rapport comme artefact
        uses: actions/upload-artifact@v4
        with:
          name: rapport_nikto
          path: rapport_nikto.txt
