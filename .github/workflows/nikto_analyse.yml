name: Analyse de sÃ©curitÃ© Nikto

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  workflow_dispatch:   # permet de dÃ©clencher manuellement si besoin

jobs:
  nikto_scan:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ§© RÃ©cupÃ©ration du code source
        uses: actions/checkout@v4

      - name: ğŸ Installation de Python et des dÃ©pendances
        run: |
          sudo apt-get update -y
          sudo apt-get install -y python3 python3-pip
          pip install -r requirements.txt || true

      - name: ğŸš€ Lancer le serveur Flask en arriÃ¨re-plan
        run: |
          nohup python3 app.py &
          sleep 10   # Attendre que le serveur dÃ©marre

      - name: ğŸ§° Installer Nikto
        run: |
          sudo apt-get install -y nikto

      - name: ğŸ§ª ExÃ©cuter lâ€™analyse Nikto
        run: |
          nikto -h http://127.0.0.1:5000 -o rapport_nikto.txt -Format txt
          cat rapport_nikto.txt

      - name: ğŸ’¾ Sauvegarder le rapport comme artefact
        uses: actions/upload-artifact@v4
        with:
          name: rapport_nikto
          path: rapport_nikto.txt
